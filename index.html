<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<link
        rel="stylesheet"
        href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css"
    />

		<title>Final Project 2016</title>

		<script type="text/javascript" src="d3/d3.js"></script>

		<style type="text/css">


		body {
			font: 17px Arial;
			font-size: 14px sans-serif;
			background-color: #D3D3D3;
		}


			.axis path,
			.axis line {
				fill: none;
				stroke: grey;
        stroke-width: 2px;
				shape-rendering: crispEdges;
			}

      .legend {
      padding: 5px;
      font: 12px sans-serif;
      background: black;
			background-color: black;
      box-shadow: 2px 2px 1px #888;
      }

      .title {
      	font: 13px sans-serif;
      }

			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}

      #boroughs {
        stroke: grey;
      	stroke-width: 2px;
      	fill: steelblue;
      }

			p {
					/*margin:0;*/
					/*padding:0;*/
					text-align: center;
					/*list-style:none;*/
			}

			ul {
					/*margin:0;*/
					/*padding:0;*/
					text-align: center;
					list-style:none;
			}

		</style>

	</head>

  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
	<script src="http://leaflet.github.io/Leaflet.heat/dist/leaflet-heat.js"></script>
	<script src="VC_density.js"></script>

	<body>

	<h1 align="center">Social data analysis and visualization (02806), Final Project </h1>
	<p align="center"> May 17, 2016 </p>
	<p> Click <a href="http://nbviewer.jupyter.org/gist/MogensOst/0311b063af621c370855366073881f4c">here</a> to see our notebook </p>

	<h2 align="center">Vehicle Collisions in New York City</h2>
	<p align="center">
		In New York City more than 200.000 collisions occurs every year. On this page we will take a closer look into vehicle collisions in New York City, which are reported by the NYPD.
		<br> In order to do this we will look at some of the different factors involved in these collisions. </br>
	<br>	NYC consists of five different boroughs.</br>
	</p>

	<center><img border="0.8" src="nyc_boroughs.png" width="500" height="300" /><img border="0.8" src="nyc_beauty.png" width="500" height="300" /></center>
	<p align="center">
		<font size="2"><p> Click <a href="https://en.wikipedia.org/wiki/Borough_(New_York_City)">here</a> to see image reference </p></font>
	</p>

	<p align="center">
		The five boroughs of New York City: 1: <font color="green">Manhattan</font>, 2: <font color="yellow">Brooklyn</font>, 3: <font color="orange">Queens</font>, 4: <font color="red">The Bronx</font>, 5: <font color="purple">Staten Island</font>
	<br>	The Population of each borough: </br>
	</p>

	<ul>
	  <center><li align="center"><font color="green">Manhattan</font>: 1,636,268</li></center>
	  <center><li><font color="yellow">Brooklyn</font>: 2,621,793</li></center>
	  <center><li><font color="orange">Queens</font>: 2,321,580</li></center>
		<center><li><font color="red">The Bronx</font>: 1,438,159</li></center>
		<center><li><font color="purple">Staten Island</font>: 473,279</li></center>
	</ul>

	<h2 align="center">Density/heat map</h2>
	<p> This is a interactive density map of all the collisions (nearly 650,000) in New York City from July 2012 - 2016.
		The number of collisions are represented by the color of the point, the darker the point is, the more collisions has happend at those exact coordinates.
	 <b>Zoom in/out on the map!</b> </p>
	<center><div id="map1" align="center" style="width: 800px; height: 600px"></div></center>
	<p> The most dense area is Manhattan, and the least dense is Staten Island. This makes perfect sense taking population and people travelling to and from Manhattan every day into account </p>


  <h2 align="center">Histogram of Vehicle Collisions in New York City, in the five different boroughs</h2>
	<p align="center">
		The histogram below shows all the collsions for each borough from year 2012 to 2016. The bottom "Normalized Data" shows the number of collision per capita in each borough.
		This gives another perspective of the collisions in each borough. Though keep in mind, that it is likely that the person(s) involved in the crash, is not from that paticular bourough.
	</p>
	<p align="center">
	<input type="button" align="center" value="Original Data" id="p1" onclick="p1">
  <input type="button" align="center" value="Normalized Data" id="p2" onclick="p2">
	</p>
  <div id="histVC" align="center"></div>
	<p> This especially changes the way you look at the number of collisions on Staten Island. </p>


	<h2 align="center">Three Linecharts</h2>
	<p align="center"> The linechart below shows collisions in each borough per year. All the factors categorized as "Unspecified" has been filtered out (a lot), of both the linecharts.
	<br> <b>Click</b> on the legend to toggle on/off the different boroughs </br>
 	</p>
  <div id="LineChart" align="center"></div>


	<!-- <p align="center"> Linechart showing all the vehicle collisions each month. The data is kind of skewed due to the fact that the dataset don't consist the full year of 2012 and 2016.
	<br> Year 2012 is from June till December, and year 2016 is from January till April only. </br> </p>
	<div id="lineMonth" align="center"></div> -->


	<p align="center"> This plot visualizes the number of collisions each Hour. It makes sense that there are less collisions during the night, and more during rush hour. </p>
	<div id="LineHour" align="center"></div>

	<h2 align="center">Six interesting contributing factors</h2>
	<p align="center"> The dataset consists of over 50 different contributing factors which can cause a vehicle collision. Below are six factors we find interesting plottted.
	The factors chosen are also not too prevailing, otherwise the map would show nothing but colored dots. After all, over 650.000 vehicle collisions has occurred. </p>
  <div id="FunFacts" align="center"></div>

	<p> It is kind of disturbing the amount of crashes are caused due to the driver being intoxicated in some way to prescribtion medication (nearly 13,000 times). </p>

	<h2 align="center">Top 20 collision intersections vs top 20 locations of pot-hole complaints</h2>
	<p > This interactive map shows the top 20 most dangerous intersections (red circles), and the 20 most complained-about pothole locations (blue circle).
	 The radius of the circle is based on the number of crashes/complaints. </p>
	<center><div id="map2" style="width: 800px; height: 600px"></div></center>
	<p> As seen on the map, there is one location where both collisions and pot-holes overlap. It is reasonable to assume that the pot-hole might be contributing to the crashes. Maybe New York City should fix these?
	 Note that most collisions happen in Manhatten as previously stated, and by far most pot-hole complaints occurs on Staten Island. This might be due to families actually bothering to complain about the pot-holes, instead of just ignoring them. </p>

	<h2 align="center"> K-means map, with clusters </h2>
	<p align="center"> K means have been chosen since we wanted to visualize how drunk driving incidents are distributed throughout the city of New York.
		We used the K means function with 2 to 6 different clusters on the vehicle collision data, for the contributing factor "Alcohol Involvement" respectively and a visualization of the clusters on a map.
		Each cluster has it's own color, so the clusters are easily distinguished. Below the visualization, one can toggle how many clusters one would like to see.
		We can see that for different number of clusters that the algrithm finds clusters that represent the data well.
		The centroids of the clusters seem reasonable as well, so the algorithm works well for distinguishing different areas of the vehicle collisions with Alcohol Involvement in New York City.
	</p>
	<p align="center">
	<input type="button" align="center" value="2 clusters" id="K2" onclick="Kfunction('Kmeans2.csv','Centroids2.csv','2')">
	<input type="button" align="center" value="3 clusters" id="K3" onclick="Kfunction('Kmeans3.csv','Centroids3.csv','3')">
	<input type="button" align="center" value="4 clusters" id="K4" onclick="Kfunction('Kmeans4.csv','Centroids4.csv','4')">
	<input type="button" align="center" value="5 clusters" id="K5" onclick="Kfunction('Kmeans5.csv','Centroids5.csv','5')">
	<input type="button" align="center" value="6 clusters" id="K6" onclick="Kfunction('Kmeans6.csv','Centroids6.csv','6')">
	</p>

	<div id="Kmeans" align="center"></div>
<h2 align="center"> K-nearest neighbors </h2>
<p> Map of 5-nearest neighbors showing Oversize vehicle(red), Illness(green) and Brakes Deffective (blue).
<br> Note, Staten Island is <b>not</b> included in the knn due to the boundery-box being a square. Making predictions based on other places than NYC would be flawed, to say the least.</br> </p>
<center><img border="0.8" src="knn-5.png" width="600" height="400" /></center>

	<h2 align="center"><b> The end! </b> </h2>


<script src="HistVCYEAR.js"></script>
<script src="FunFacts.js"></script>
<script src="LineChart.js"></script>
<script src="lineHour.js"></script>
<!-- <script src="lineMonth.js"></script> -->
<!-- <script src="KMeans.js"></script> -->


<script>
var width1 = 960,
   height1 = 800;

var svg = d3.select("#Kmeans").append("svg")
    .attr("width", width1)
    .attr("height", height1);


		var g = svg.append("g");
		var mapLayer = g.append('g')
		var pointsLayer = g.append('g')
		var centroidLayer = g.append('g')

var label_colors = ["(255,0,0)","(0,255,0)","(0,0,255)","(0,255,255)","(255,255,255)","(255,0,255)"]

d3.json("BoroughBoundaries.json", function(error, nycb) {
	// console.log(nycb)

var projectionKM = d3.geo.mercator()
			.center([-73.90, 40.70])
			.scale(70000)
			.translate([(width1) / 2, (height1)/2]);


var pathKM = d3.geo.path()
			.projection(projectionKM);

		 mapLayer.append("g")
		 .attr("id", "boroughs")
		 .selectAll(".state")
		 .data(nycb.features)
		 .enter().append("path")
		 .attr("class", function(d){ return d.properties.name; })
		 .attr("d", pathKM);


		 d3.csv('Kmeans2.csv', function(dataKM) {
			// 	console.log(dataKM)
		 		//Draw circles
		 		  pointsLayer.selectAll("circle")
		 				.data(dataKM)
		 				.enter().append("circle")
		 				.attr("r", 2)
		 				.attr("opacity", "0.6")
		 				.attr("transform", function(d) {
		 					return "translate(" + projectionKM([
		 					d.Xe,
		 					d.Ye
		 					]) + ")";
		 	 })
		 				.attr("fill",function(d){
		 						return "rgb" + label_colors[d.labels];
		 				});


		 				})

		 				d3.csv('Centroids2.csv', function(dataKM) {

		 						//Draw circles
		 						  centroidLayer.selectAll("circle")
		 								.data(dataKM)
		 								.enter().append("circle")
		 								.attr("r", 35)
										.style("stroke", "black")
										.style("stroke-width", 2)
		 								.attr("opacity", "0.8")
		 								.attr("transform", function(d) {
		 									return "translate(" + projectionKM([
		 									d.Xc,
		 									d.Yc
		 									]) + ")";
		 					 })
		 								.attr("fill",function(d){
		 										return "rgb" + label_colors[d.labels];
		 								})

		 									});


});

function Kfunction(datastring,centroids,title){

		d3.json("BoroughBoundaries.json", function(error, nycb) {
			// console.log(nycb)

		var projectionKM = d3.geo.mercator()
					.center([-73.90, 40.70])
					.scale(70000)
					.translate([(width1) / 2, (height1)/2]);


		var pathKM = d3.geo.path()
					.projection(projectionKM);



				 mapLayer.append("path") //ændret g til path
				 .attr("id", "boroughs")
				 .selectAll(".state")
				 .data(nycb.features)
				 .enter().append("path")
				 .attr("class", function(d){ return d.properties.name; })
				 .attr("d", pathKM);



		d3.csv(datastring, function(dataKM) {
// console.log(dataKM)
				//Draw circles
				  pointsLayer.selectAll("circle")
						.data(dataKM)
						.transition()
						.duration(1000)
						.attr("r", 2)
						.attr("opacity", ".6")
						.attr("transform", function(d) {
							return "translate(" + projectionKM([
							d.Xe,
							d.Ye
							]) + ")";
			 })
						.attr("fill",function(d){
								return "rgb" + label_colors[d.labels];
						});


						})

						d3.csv(centroids, function(dataKM) {
							// console.log(dataKM)
								//Draw circles
								  centroidLayer.selectAll("circle")
										.data(dataKM)
										.transition()
										.duration(1000)
										.attr("r", 35)
										.attr("opacity", "0.8")
										.attr("transform", function(d) {
											return "translate(" + projectionKM([
											d.Xc,
											d.Yc
											]) + ")";
							 })
										.attr("fill",function(d){
												return "rgb" + label_colors[d.labels];
										});
			})
   });
		};
</script>

<script>
	var map = L.map('map1').setView([40.73, -73.90], 11);
	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
	  maxZoom: 18,
	  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
	    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
	    'Imagery © <a href="http://mapbox.com">Mapbox</a>',
	  id: 'mapbox.streets'
	}).addTo(map);

	        var heat = L.heatLayer(VehicleCollisions,{
	            radius: 4,
	            blur: 6,
	            maxZoom: 17,
	        }).addTo(map);
</script>

<script type="text/javascript">

			function tot_count(n){
				var counters = [585, 472, 455, 433, 417, 368, 354, 353, 350, 347, 343, 334, 334, 332, 324, 322, 319, 317, 314, 311];
				return counters[n];
			}

			function pot_count(n){
				var Pcounters = [157, 149, 134, 97, 87, 86, 79, 76, 71, 67, 67, 66, 66, 65, 64, 64, 63, 63, 62, 61];
				return Pcounters[n];
			}

			var map2 = L.map('map2').setView([40.73, -73.90], 11);


			L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
				maxZoom: 18,
				attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
					'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
					'Imagery © <a href="http://mapbox.com">Mapbox</a>',
				id: 'mapbox.streets'
			}).addTo(map2);

/* Initialize the SVG layer */
map2._initPathRoot()

/* We simply pick up the SVG from the map object */
var svg1 = d3.select("#map2").select("svg"),
g1 = svg1.append("g");

d3.json("circles.json", function(collection) {
	/* Add a LatLng object to each item in the dataset */
	collection.objects.forEach(function(d) {
		d.LatLng = new L.LatLng(d.circle.coordinates[0],
								d.circle.coordinates[1])
	})

	d3.json("potholes.json", function(collection1) {
		/* Add a LatLng object to each item in the dataset */
		collection1.objects.forEach(function(d) {
			d.LatLng1 = new L.LatLng(d.circle1.coordinates[0],
									d.circle1.coordinates[1])
		})

	var feature = g1.selectAll("circle")
		.data(collection.objects)
		// .data(collection1.objects)
		.enter().append("circle")
		.attr('class', 'circle')
		.style("stroke", "black")
		.style("opacity", .6)
		.style("fill", "red")
		.attr("r", function(d, i){
		 return tot_count(i)*0.03
		});

		var feature1 = g1.selectAll(".circle1")
			.data(collection1.objects)
			.enter().append("circle")
			.attr('class', 'circle1')
			.style("stroke", "black")
			.style("opacity", .6)
			.style("fill", "blue")
			.attr("r", function(d, i){
			 return pot_count(i)*0.10
			});

	map2.on("viewreset", update);
	update();

	function update() {
		feature.attr("transform",
		function(d) {
			return "translate("+
				map2.latLngToLayerPoint(d.LatLng).x +","+
				map2.latLngToLayerPoint(d.LatLng).y +")";
			}
		)
		feature1.attr("transform",
		function(d) {
			return "translate("+
				map2.latLngToLayerPoint(d.LatLng1).x +","+
				map2.latLngToLayerPoint(d.LatLng1).y +")";
			}
		)
	}
})
})

</script>

		</script>
	</body>
</html>
